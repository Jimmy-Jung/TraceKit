# ğŸ”Œ ì™¸ë¶€ ì—°ë™

> ì‘ì„±ì¼: 2025-12-15
> ì‘ì„±ì: jimmy

## ê°œìš”

LoggerëŠ” ì™¸ë¶€ ëª¨ë‹ˆí„°ë§/ë¶„ì„ ì„œë¹„ìŠ¤ì™€ ì—°ë™í•˜ê¸° ìœ„í•œ ë³„ë„ ëª¨ë“ˆì„ ì œê³µí•©ë‹ˆë‹¤.

> ğŸ’¡ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™ í›„ì—ë„ ë™ê¸° API(`Logger.error(...)`)ë¡œ ê°„í¸í•˜ê²Œ ë¡œê¹…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
> ë‚´ë¶€ì ìœ¼ë¡œ Fire-and-Forget íŒ¨í„´ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.

| ëª¨ë“ˆ | ì„œë¹„ìŠ¤ | ìš©ë„ |
|-----|-------|------|
| LoggerSentry | Sentry | ì—ëŸ¬ ëª¨ë‹ˆí„°ë§, ì´ìŠˆ ì¶”ì  |
| LoggerDatadog | Datadog | ë¡œê·¸ ë¶„ì„, ë©”íŠ¸ë¦­ |
| LoggerFirebase | Firebase Crashlytics | í¬ë˜ì‹œ ë¦¬í¬íŒ… |

## ëª¨ë“ˆ ì„¤ì¹˜

### Tuist ì„¤ì •

```swift
// Workspace.swift
let workspace = Workspace(
    name: "MyApp",
    projects: [
        "Projects/MyApp",
        "Projects/Logger",
        "Projects/LoggerSentry",     // Sentry ì‚¬ìš© ì‹œ
        "Projects/LoggerDatadog",    // Datadog ì‚¬ìš© ì‹œ
        "Projects/LoggerFirebase"    // Firebase ì‚¬ìš© ì‹œ
    ]
)

// Project.swift (MyApp)
let project = Project(
    name: "MyApp",
    targets: [
        .target(
            name: "MyApp",
            dependencies: [
                .project(target: "Logger", path: "../Logger"),
                .project(target: "LoggerSentry", path: "../LoggerSentry"),
                // ...
            ]
        )
    ]
)
```

## Sentry ì—°ë™

### ì„¤ì¹˜

1. Sentry SDK ì¶”ê°€ (SPM)
2. LoggerSentry ëª¨ë“ˆ í™œì„±í™”

### ì´ˆê¸°í™”

```swift
import Logger
import LoggerSentry

@main
struct MyApp: App {
    init() {
        Task {
            await setupLogger()
        }
    }
    
    @LoggerActor
    func setupLogger() async {
        let sentryDestination = SentryLogDestination(
            dsn: "https://xxx@sentry.io/123",
            minLevel: .info,
            breadcrumbMinLevel: .debug,  // Breadcrumbì— debug ì´ìƒ ê¸°ë¡
            eventMinLevel: .error,       // Eventë¡œëŠ” error ì´ìƒë§Œ ì „ì†¡
            environment: "production",
            debug: false
        )
        
        let logger = await LoggerBuilder()
            .addConsole()
            .addDestination(sentryDestination)
            .buildAsShared()
    }
}
```

### ë™ì‘ ë°©ì‹

```mermaid
%%{init: {
  'theme': 'dark',
  'themeVariables': { 'lineColor': '#e2e8f0', 'textColor': '#f8fafc' }
}}%%
flowchart LR
    subgraph Logger
        L["LogMessage"]
    end
    
    subgraph Sentry["Sentry Destination"]
        B["Breadcrumb"]
        E["Event"]
    end
    
    subgraph SentrySDK["Sentry SDK"]
        BC["Breadcrumb ì €ì¥"]
        EC["Event ì „ì†¡"]
    end
    
    L -->|debug ì´ìƒ| B
    L -->|error ì´ìƒ| E
    B --> BC
    E --> EC
    
    classDef log fill:#3b82f6,stroke:#60a5fa,color:#ffffff
    classDef sentry fill:#8b5cf6,stroke:#a78bfa,color:#ffffff
    classDef sdk fill:#ef4444,stroke:#f87171,color:#ffffff
    
    class L log
    class B,E sentry
    class BC,EC sdk
```

| ë ˆë²¨ | Breadcrumb | Event |
|-----|------------|-------|
| verbose | âŒ | âŒ |
| debug | âœ… | âŒ |
| info | âœ… | âŒ |
| warning | âœ… | âŒ |
| error | âœ… | âœ… |
| fatal | âœ… | âœ… |

### ì‚¬ìš©ì ì •ë³´ ì„¤ì •

```swift
Task {
    let sentryDest = await getSentryDestination()
    
    // ì‚¬ìš©ì ì„¤ì •
    await sentryDest.setUser(
        id: "user123",
        email: "user@example.com",
        username: "John"
    )
    
    // íƒœê·¸ ì¶”ê°€
    await sentryDest.setTag(key: "plan", value: "premium")
    
    // ì»¨í…ìŠ¤íŠ¸ ì¶”ê°€
    await sentryDest.setContext(
        key: "feature_flags",
        value: ["newUI": true, "darkMode": true]
    )
}
```

### Sentry ë ˆë²¨ ë§¤í•‘

| LogLevel | SentryLevel |
|----------|-------------|
| verbose, debug | .debug |
| info | .info |
| warning | .warning |
| error | .error |
| fatal | .fatal |

## Datadog ì—°ë™

### ì„¤ì¹˜

1. Datadog SDK ì¶”ê°€ (SPM)
2. LoggerDatadog ëª¨ë“ˆ í™œì„±í™”

### ì´ˆê¸°í™”

```swift
import Logger
import LoggerDatadog
import DatadogCore

@main
struct MyApp: App {
    init() {
        Task {
            await setupLogger()
        }
    }
    
    @LoggerActor
    func setupLogger() async {
        // Datadog SDK ì´ˆê¸°í™” (ì•± ì‹œì‘ ì‹œ 1íšŒ)
        Datadog.initialize(
            with: Datadog.Configuration(
                clientToken: "pub_xxx",
                env: "production",
                service: "my-ios-app"
            ),
            trackingConsent: .granted
        )
        
        let datadogDestination = DatadogLogDestination(
            clientToken: "pub_xxx",
            environment: "production",
            serviceName: "my-ios-app",
            minLevel: .info
        )
        
        let logger = await LoggerBuilder()
            .addConsole()
            .addDestination(datadogDestination)
            .buildAsShared()
    }
}
```

### ë¡œê·¸ êµ¬ì¡°

Datadogìœ¼ë¡œ ì „ì†¡ë˜ëŠ” ë¡œê·¸ êµ¬ì¡°:

```json
{
  "message": "ì‚¬ìš©ì ë¡œê·¸ì¸ ì„±ê³µ",
  "status": "info",
  "service": "my-ios-app",
  "attributes": {
    "category": "Auth",
    "file": "AuthManager.swift",
    "function": "login()",
    "line": 42,
    "userId": "user123",
    "sessionId": "sess_abc",
    "appVersion": "1.0.0",
    "osVersion": "17.0",
    "deviceModel": "iPhone15,2"
  }
}
```

### ì „ì—­ ì†ì„±/íƒœê·¸ ê´€ë¦¬

```swift
Task {
    let datadogDest = await getDatadogDestination()
    
    // ì „ì—­ ì†ì„± ì¶”ê°€
    await datadogDest.addAttribute(key: "userId", value: "user123")
    await datadogDest.addAttribute(key: "plan", value: "premium")
    
    // ì „ì—­ ì†ì„± ì œê±°
    await datadogDest.removeAttribute(key: "userId")
    
    // íƒœê·¸ ì¶”ê°€
    await datadogDest.addTag(key: "feature", value: "checkout")
    
    // íƒœê·¸ ì œê±°
    await datadogDest.removeTag(key: "feature")
}
```

### Datadog ë ˆë²¨ ë§¤í•‘

| LogLevel | Datadog ë©”ì„œë“œ |
|----------|---------------|
| verbose, debug | `logger.debug()` |
| info | `logger.info()` |
| warning | `logger.warn()` |
| error | `logger.error()` |
| fatal | `logger.critical()` |

## Firebase Crashlytics ì—°ë™

### ì„¤ì¹˜

1. Firebase SDK ì¶”ê°€ (SPM ë˜ëŠ” CocoaPods)
2. GoogleService-Info.plist ì¶”ê°€
3. LoggerFirebase ëª¨ë“ˆ í™œì„±í™”

### ì´ˆê¸°í™”

```swift
import Logger
import LoggerFirebase
import FirebaseCore

@main
struct MyApp: App {
    init() {
        // Firebase ì´ˆê¸°í™”
        FirebaseApp.configure()
        
        Task {
            await setupLogger()
        }
    }
    
    @LoggerActor
    func setupLogger() async {
        let crashlyticsDestination = CrashlyticsLogDestination(
            minLevel: .info
        )
        
        let logger = await LoggerBuilder()
            .addConsole()
            .addDestination(crashlyticsDestination)
            .buildAsShared()
    }
}
```

### ë™ì‘ ë°©ì‹

```mermaid
%%{init: {
  'theme': 'dark',
  'themeVariables': { 'lineColor': '#e2e8f0', 'textColor': '#f8fafc' }
}}%%
flowchart LR
    subgraph Logger
        L["LogMessage"]
    end
    
    subgraph Crashlytics["Crashlytics Destination"]
        LOG["log()"]
        REC["recordError()"]
    end
    
    subgraph Firebase["Firebase SDK"]
        CL["Crashlytics.log"]
        CE["Crashlytics.record"]
    end
    
    L -->|info ì´ìƒ| LOG
    L -->|error ì´ìƒ| REC
    LOG --> CL
    REC --> CE
    
    classDef log fill:#3b82f6,stroke:#60a5fa,color:#ffffff
    classDef crash fill:#f59e0b,stroke:#fbbf24,color:#1f2937
    classDef firebase fill:#ef4444,stroke:#f87171,color:#ffffff
    
    class L log
    class LOG,REC crash
    class CL,CE firebase
```

| ë ˆë²¨ | log() | recordError() |
|-----|-------|---------------|
| verbose | âŒ | âŒ |
| debug | âŒ | âŒ |
| info | âœ… | âŒ |
| warning | âœ… | âŒ |
| error | âœ… | âœ… (Non-fatal) |
| fatal | âœ… | âœ… (Non-fatal) |

### ì‚¬ìš©ì ì •ë³´ ì„¤ì •

```swift
Task {
    let crashlyticsDest = await getCrashlyticsDestination()
    
    // ì‚¬ìš©ì ID ì„¤ì •
    await crashlyticsDest.setUserId("user123")
    
    // ì»¤ìŠ¤í…€ í‚¤ ì„¤ì •
    await crashlyticsDest.setCustomKey("plan", value: "premium")
    await crashlyticsDest.setCustomKey("loginCount", value: 42)
    
    // ì—¬ëŸ¬ í‚¤ í•œ ë²ˆì— ì„¤ì •
    await crashlyticsDest.setCustomKeys([
        "feature_a": true,
        "feature_b": false,
        "experiment_id": "exp_123"
    ])
}
```

## ë³µí•© êµ¬ì„± ì˜ˆì œ

### ëª¨ë“  ì„œë¹„ìŠ¤ ì—°ë™

```swift
import Logger
import LoggerSentry
import LoggerDatadog
import LoggerFirebase

@LoggerActor
func setupProductionLogger() async {
    // Sentry - ì—ëŸ¬ ì¶”ì 
    let sentryDest = SentryLogDestination(
        dsn: "https://xxx@sentry.io/123",
        minLevel: .warning,
        eventMinLevel: .error,
        environment: "production"
    )
    
    // Datadog - ë¡œê·¸ ë¶„ì„
    let datadogDest = DatadogLogDestination(
        clientToken: "pub_xxx",
        environment: "production",
        serviceName: "my-app",
        minLevel: .info
    )
    
    // Crashlytics - í¬ë˜ì‹œ ë¦¬í¬íŒ…
    let crashlyticsDest = CrashlyticsLogDestination(
        minLevel: .info
    )
    
    // Logger êµ¬ì„±
    let logger = await LoggerBuilder()
        // ë¡œì»¬ ì¶œë ¥
        .addConsole(minLevel: .warning)
        .addOSLog(minLevel: .info)
        .addFile(minLevel: .debug)
        
        // ì™¸ë¶€ ì„œë¹„ìŠ¤
        .addDestination(sentryDest)
        .addDestination(datadogDest)
        .addDestination(crashlyticsDest)
        
        // ì •ì±…
        .withBuffer(policy: .default)
        .withSampling(policy: .production)
        .withDefaultSanitizer()
        .withDefaultContextProvider(environment: .production)
        
        .buildAsShared()
}
```

### í™˜ê²½ë³„ êµ¬ì„±

```swift
@LoggerActor
func setupLogger(environment: Environment) async {
    let builder = LoggerBuilder()
        .addConsole(formatter: PrettyLogFormatter.verbose)
        .withDefaultSanitizer()
    
    switch environment {
    case .debug:
        // ë””ë²„ê·¸: ì½˜ì†”ë§Œ
        _ = await builder
            .with(configuration: .debug)
            .buildAsShared()
        
    case .staging:
        // ìŠ¤í…Œì´ì§•: ì½˜ì†” + Sentry
        let sentry = SentryLogDestination(
            dsn: "https://xxx@sentry.io/staging",
            minLevel: .debug,
            environment: "staging"
        )
        _ = await builder
            .addDestination(sentry)
            .buildAsShared()
        
    case .production:
        // í”„ë¡œë•ì…˜: ì „ì²´ êµ¬ì„±
        let sentry = SentryLogDestination(
            dsn: "https://xxx@sentry.io/prod",
            minLevel: .warning,
            environment: "production"
        )
        let crashlytics = CrashlyticsLogDestination(minLevel: .info)
        
        _ = await builder
            .addOSLog(minLevel: .info)
            .addFile(minLevel: .info)
            .addDestination(sentry)
            .addDestination(crashlytics)
            .withBuffer(policy: .default)
            .withSampling(policy: .production)
            .buildAsShared()
    }
}
```

## ë¬¸ì œ í•´ê²°

### Sentry ì´ë²¤íŠ¸ê°€ ì „ì†¡ë˜ì§€ ì•ŠìŒ

1. DSNì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
2. `eventMinLevel` ì„¤ì • í™•ì¸ (ê¸°ë³¸: .error)
3. ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸
4. `debug: true`ë¡œ ì„¤ì •í•˜ì—¬ ë¡œê·¸ í™•ì¸

### Datadog ë¡œê·¸ê°€ ë³´ì´ì§€ ì•ŠìŒ

1. `clientToken`ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
2. í™˜ê²½(environment)ê³¼ ì„œë¹„ìŠ¤ëª… í™•ì¸
3. Datadog ëŒ€ì‹œë³´ë“œì˜ í•„í„° ì„¤ì • í™•ì¸
4. ìƒ˜í”Œë§ ì •ì±…ìœ¼ë¡œ í•„í„°ë§ë˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸

### Crashlytics ë¡œê·¸ê°€ ì—†ìŒ

1. `GoogleService-Info.plist` í™•ì¸
2. `FirebaseApp.configure()` í˜¸ì¶œ í™•ì¸
3. í¬ë˜ì‹œ ë°œìƒ í›„ ì•± ì¬ì‹¤í–‰ í•„ìš”
4. ë””ë²„ê±° ì—°ê²° ì‹œ í¬ë˜ì‹œ ë¦¬í¬íŠ¸ ë¹„í™œì„±í™”ë¨

## ë‹¤ìŒ ë‹¨ê³„

- [ëŸ°íƒ€ì„ ì„¤ì •](./06-ëŸ°íƒ€ì„-ì„¤ì •.md) - Launch Argumentsë¡œ ë™ì  ì œì–´

