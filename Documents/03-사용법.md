# ğŸ“ ì‚¬ìš©ë²•

> ì‘ì„±ì¼: 2025-12-15
> ì‘ì„±ì: jimmy

## ê¸°ë³¸ ì‚¬ìš©ë²•

### 1. ê°€ì¥ ê°„ë‹¨í•œ ì‚¬ìš© (ë™ê¸° API)

LoggerëŠ” `await` ì—†ì´ë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```swift
import Logger

// await ì—†ì´ ë°”ë¡œ ì‚¬ìš© (Fire-and-Forget)
Logger.info("ì•±ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤")

// ì¸ìŠ¤í„´ìŠ¤ ë©”ì„œë“œë„ ë™ì¼í•˜ê²Œ ì‚¬ìš©
Logger.shared.info("ì•±ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤")
```

### 2. ë ˆë²¨ë³„ ë¡œê¹…

```swift
import Logger

// ë™ê¸° API (await ë¶ˆí•„ìš”) - ê¶Œì¥
Logger.verbose("í•¨ìˆ˜ ì§„ì…: loadData()")
Logger.debug("API ìš”ì²­: GET /users")
Logger.info("ì‚¬ìš©ì ë¡œê·¸ì¸ ì„±ê³µ")
Logger.warning("í† í° ë§Œë£Œê¹Œì§€ 5ë¶„ ë‚¨ìŒ")
Logger.error("ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹¤íŒ¨")
Logger.fatal("ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë¶ˆê°€")

// ë¹„ë™ê¸° API (await í•„ìš”) - ë¡œê·¸ ì™„ë£Œ ëŒ€ê¸° ì‹œ ì‚¬ìš©
Task {
    await Logger.shared.info("ë¡œê·¸ ì™„ë£Œê¹Œì§€ ëŒ€ê¸°")
}
```

### 3. ë™ê¸° vs ë¹„ë™ê¸° API

| ìƒí™© | ê¶Œì¥ API | ì˜ˆì‹œ |
|-----|---------|-----|
| ì¼ë°˜ ë¡œê¹… | ë™ê¸° (await ì—†ìŒ) | `Logger.info("message")` |
| UI/ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ | ë™ê¸° (await ì—†ìŒ) | `Logger.debug("button tapped")` |
| ë¡œê·¸ ì™„ë£Œ ëŒ€ê¸° í•„ìš” | ë¹„ë™ê¸° (await) | `await Logger.shared.info("...")` |
| í…ŒìŠ¤íŠ¸ì—ì„œ ê²€ì¦ | ë¹„ë™ê¸° (await) | `await Logger.shared.flush()` |

### 4. ì¹´í…Œê³ ë¦¬ì™€ ë©”íƒ€ë°ì´í„°

```swift
import Logger

// ë™ê¸° APIë¡œ ì¹´í…Œê³ ë¦¬ ì§€ì •
Logger.info("API ìš”ì²­ ì‹œì‘", category: "Network")

// ë©”íƒ€ë°ì´í„° ì¶”ê°€
Logger.info(
    "ì‚¬ìš©ì ë¡œê·¸ì¸",
    category: "Auth",
    metadata: [
        "userId": AnyCodable("user123"),
        "method": AnyCodable("OAuth"),
        "provider": AnyCodable("Google")
    ]
)
```

## Logger ì„¤ì •

### LoggerBuilder ì‚¬ìš©

```swift
import Logger

@main
struct MyApp: App {
    init() {
        Task {
            await setupLogger()
        }
    }
    
    @LoggerActor
    func setupLogger() async {
        let logger = await LoggerBuilder()
            // Destinations
            .addConsole(
                minLevel: .verbose,
                formatter: PrettyLogFormatter.verbose
            )
            .addOSLog(
                subsystem: "com.myapp",
                minLevel: .info
            )
            .addFile(
                minLevel: .info,
                retentionPolicy: .default
            )
            // ì •ì±…
            .withBuffer(policy: .default)
            .withSampling(policy: .production)
            // ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹
            .withDefaultSanitizer()
            // ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸
            .withDefaultContextProvider(environment: .production)
            // Launch Argument ì ìš©
            .applyLaunchArguments()
            // ê³µìœ  ì¸ìŠ¤í„´ìŠ¤ë¡œ ë¹Œë“œ
            .buildAsShared()
    }
    
    var body: some Scene {
        WindowGroup {
            ContentView()
        }
    }
}
```

### í”„ë¦¬ì…‹ ì‚¬ìš©

```swift
// ë””ë²„ê·¸ìš© (ëª¨ë“  ë¡œê·¸, ìƒì„¸ ì¶œë ¥)
let debugLogger = await LoggerBuilder.debug().buildAsShared()

// í”„ë¡œë•ì…˜ìš© (ìµœì í™”ëœ ì„¤ì •)
let prodLogger = await LoggerBuilder.production().buildAsShared()
```

### ë””ë²„ê·¸ í”„ë¦¬ì…‹ êµ¬ì„±

```swift
// LoggerBuilder.debug()ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±ë©ë‹ˆë‹¤
LoggerBuilder()
    .addConsole(formatter: PrettyLogFormatter.verbose)
    .with(configuration: .debug)
    .withDefaultSanitizer()
    .applyLaunchArguments()
```

### í”„ë¡œë•ì…˜ í”„ë¦¬ì…‹ êµ¬ì„±

```swift
// LoggerBuilder.production()ì€ ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì´ êµ¬ì„±ë©ë‹ˆë‹¤
LoggerBuilder()
    .addConsole(minLevel: .warning)
    .addOSLog(minLevel: .info)
    .addFile(minLevel: .info)
    .with(configuration: .production)
    .withBuffer(policy: .default)
    .withSampling(policy: .production)
    .withDefaultSanitizer()
    .withCrashPreservation()
    .applyLaunchArguments()
```

## Formatter

### PrettyLogFormatter (ì½˜ì†”ìš©)

```swift
// ìµœì†Œ ì¶œë ¥ (ë ˆë²¨ + ë©”ì‹œì§€ë§Œ)
let minimal = PrettyLogFormatter.minimal
// ì¶œë ¥: "â„¹ï¸ INFO ì•±ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤"

// í‘œì¤€ ì¶œë ¥ (ê¸°ë³¸ê°’)
let standard = PrettyLogFormatter.standard
// ì¶œë ¥: "14:32:15.123 â„¹ï¸ INFO [Default] ì•±ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤ (App.swift:42)"

// ìƒì„¸ ì¶œë ¥ (ëª¨ë“  ì •ë³´)
let verbose = PrettyLogFormatter.verbose
// ì¶œë ¥: "14:32:15.123 â„¹ï¸ INFO [Auth] ì‚¬ìš©ì ë¡œê·¸ì¸ (AuthManager.swift:123) {userId=user123, method=OAuth}"
```

ì»¤ìŠ¤í…€ ì„¤ì •:

```swift
let customFormatter = PrettyLogFormatter(
    includeTimestamp: true,     // íƒ€ì„ìŠ¤íƒ¬í”„ í¬í•¨
    includeLocation: true,      // íŒŒì¼:ë¼ì¸ í¬í•¨
    includeMetadata: false,     // ë©”íƒ€ë°ì´í„° ì œì™¸
    useEmoji: false             // ì´ëª¨ì§€ ëŒ€ì‹  [LEVEL]
)
```

### JSONLogFormatter (íŒŒì¼/ë¶„ì„ìš©)

```swift
let jsonFormatter = JSONLogFormatter()
// ì¶œë ¥: {"category":"Auth","file":"AuthManager.swift",...}

let prettyJsonFormatter = JSONLogFormatter(prettyPrint: true)
// ì¶œë ¥:
// {
//   "category": "Auth",
//   "file": "AuthManager.swift",
//   ...
// }
```

## ì¶œë ¥ ëŒ€ìƒ (Destinations)

### ConsoleLogDestination

```swift
// ê¸°ë³¸ ì‚¬ìš©
let console = ConsoleLogDestination()

// ì»¤ìŠ¤í…€ ì„¤ì •
let console = ConsoleLogDestination(
    minLevel: .debug,
    isEnabled: true,
    formatter: PrettyLogFormatter.verbose,
    outputStream: .auto  // error/fatalì€ stderr, ë‚˜ë¨¸ì§€ëŠ” stdout
)
```

### OSLogDestination (iOS 14+)

```swift
let oslog = OSLogDestination(
    subsystem: Bundle.main.bundleIdentifier ?? "com.myapp",
    minLevel: .info,
    isEnabled: true
)

// OSLog ë ˆë²¨ ë§¤í•‘
// verbose, debug â†’ OSLogType.debug
// info â†’ OSLogType.info
// warning â†’ OSLogType.default
// error â†’ OSLogType.error
// fatal â†’ OSLogType.fault
```

### FileLogDestination

```swift
let fileManager = LogFileManager(
    retentionPolicy: LogFileRetentionPolicy(
        maxFileSize: 10 * 1024 * 1024,  // 10MB
        maxFileCount: 5,
        maxAge: 7 * 24 * 3600           // 7ì¼
    )
)

let file = FileLogDestination(
    minLevel: .info,
    isEnabled: true,
    formatter: JSONLogFormatter(),
    fileManager: fileManager,
    bufferSize: 10  // 10ê°œ ë¡œê·¸ í›„ íŒŒì¼ ì“°ê¸°
)
```

## Configuration

### LoggerConfiguration

```swift
// ì§ì ‘ ìƒì„±
let config = LoggerConfiguration(
    minLevel: .info,
    enabledCategories: ["Network", "Auth"],  // nilì´ë©´ ëª¨ë“  ì¹´í…Œê³ ë¦¬
    disabledDestinations: ["file"],          // ë¹„í™œì„±í™”í•  destination
    isSanitizingEnabled: true,               // ë¯¼ê°ì •ë³´ ë§ˆìŠ¤í‚¹
    sampleRate: 0.5,                         // 50% ìƒ˜í”Œë§
    bufferSize: 100,
    flushInterval: 5.0
)

// í”„ë¦¬ì…‹
let debug = LoggerConfiguration.debug       // ëª¨ë“  ë¡œê·¸, ë§ˆìŠ¤í‚¹ ë¹„í™œì„±í™”
let production = LoggerConfiguration.production  // info ì´ìƒ, 10% ìƒ˜í”Œë§
```

### ëŸ°íƒ€ì„ ì„¤ì • ë³€ê²½

```swift
Task {
    // í˜„ì¬ ì„¤ì • ë³€ê²½
    await Logger.shared.configure(
        LoggerConfiguration(minLevel: .warning)
    )
}
```

## ì‹¤ì „ ì˜ˆì œ

### ViewModelì—ì„œ ì‚¬ìš©

```swift
@MainActor
final class UserViewModel: ObservableObject {
    @Published var user: User?
    @Published var error: Error?
    
    func login(email: String, password: String) async {
        // ë™ê¸° API ì‚¬ìš© (await ë¶ˆí•„ìš”)
        Logger.info(
            "ë¡œê·¸ì¸ ì‹œë„",
            category: "Auth",
            metadata: ["email": AnyCodable(email)]  // ì´ë©”ì¼ì€ ìë™ ë§ˆìŠ¤í‚¹ë¨
        )
        
        do {
            user = try await authService.login(email: email, password: password)
            Logger.info("ë¡œê·¸ì¸ ì„±ê³µ", category: "Auth")
        } catch {
            self.error = error
            Logger.error(
                "ë¡œê·¸ì¸ ì‹¤íŒ¨: \(error.localizedDescription)",
                category: "Auth"
            )
        }
    }
}
```

### ë„¤íŠ¸ì›Œí¬ ë ˆì´ì–´ì—ì„œ ì‚¬ìš©

```swift
actor NetworkService {
    func request<T: Decodable>(_ endpoint: Endpoint) async throws -> T {
        // ì„±ëŠ¥ ì¶”ì ì€ ë¹„ë™ê¸° API ì‚¬ìš© (span ID ë°˜í™˜ í•„ìš”)
        let spanId = await Logger.shared.startSpan(name: "API: \(endpoint.path)")
        
        // ì¼ë°˜ ë¡œê¹…ì€ ë™ê¸° API ì‚¬ìš©
        Logger.debug(
            "API ìš”ì²­",
            category: "Network",
            metadata: [
                "method": AnyCodable(endpoint.method.rawValue),
                "path": AnyCodable(endpoint.path)
            ]
        )
        
        do {
            let (data, response) = try await urlSession.data(for: endpoint.urlRequest)
            
            guard let httpResponse = response as? HTTPURLResponse else {
                throw NetworkError.invalidResponse
            }
            
            Logger.debug(
                "API ì‘ë‹µ",
                category: "Network",
                metadata: [
                    "statusCode": AnyCodable(httpResponse.statusCode),
                    "dataSize": AnyCodable(data.count)
                ]
            )
            
            let result = try decoder.decode(T.self, from: data)
            
            await Logger.shared.endSpan(id: spanId)
            return result
            
        } catch {
            Logger.error(
                "API ì—ëŸ¬: \(error.localizedDescription)",
                category: "Network"
            )
            await Logger.shared.endSpan(id: spanId)
            throw error
        }
    }
}
```

### Repositoryì—ì„œ ì‚¬ìš©

```swift
actor UserRepository {
    private let networkService: NetworkService
    private let cache: UserCache
    
    func getUser(id: String) async throws -> User {
        // ë™ê¸° API ì‚¬ìš©
        Logger.verbose("getUser í˜¸ì¶œ", category: "Repository")
        
        // ìºì‹œ í™•ì¸
        if let cached = await cache.get(id: id) {
            Logger.debug("ìºì‹œ íˆíŠ¸", category: "Repository")
            return cached
        }
        
        Logger.debug("ìºì‹œ ë¯¸ìŠ¤, API í˜¸ì¶œ", category: "Repository")
        
        let user: User = try await networkService.request(.user(id: id))
        await cache.set(user)
        
        return user
    }
}
```

## ë‹¤ìŒ ë‹¨ê³„

- [ê³ ê¸‰ ê¸°ëŠ¥](./04-ê³ ê¸‰-ê¸°ëŠ¥.md) - ë²„í¼ë§, ìƒ˜í”Œë§, ë§ˆìŠ¤í‚¹ ìƒì„¸
- [ì™¸ë¶€ ì—°ë™](./05-ì™¸ë¶€-ì—°ë™.md) - Sentry, Datadog, Firebase ì—°ë™

